## 決済メニュー利用するにあたって
![gamebase_purchase_01_201812](http://static.toastoven.net/prod_gamebase/Console_IAP_Select_currency_1.0.png)
決済メニューを利用するには決済指標のための通貨を先に選択する必要があります。
最初に一度だけ設定できます。Analytics売上指標には設定された通貨コードで指標が表示されます。
一度選択した通貨コードは変更できないため、慎重に選択してください。

## Game > Gamebase > Console ご利用ガイド > 決済

アプリ内決済に関連する情報を登録し、内訳を照会することができます。
Gamebaseでは、NHN Cloud IAP(In-App Purchase、アプリ内決済)サービスを使用します。

## Store

ゲーム内でアイテムを販売するためにストアを登録します。
**Store**タブの**ストア情報リスト**から新しいストアを登録したり、登録済みのストアを管理することができます。
![gamebase_purchase_01_201812](https://static.toastoven.net/prod_gamebase/gamebase_purchase_01_201812.png)

### Register

新しいストアを登録したい場合、**ストア情報リスト**画面の**登録**ボタンをクリックします。

![gamebase_purchase_02_201812](https://static.toastoven.net/prod_gamebase/gamebase_purchase_02_201812.png)

* **ストア**登録する外部ストアを選択します。登録するストアがない場合、[カスタマーセンター](https://toast.com/support/inquiry)までご連絡ください。
* **アプリ名**登録するゲームの名前を入力します。
* **ストアアプリID**ストアから発行された情報を入力します。
* **使用有無**ストアを使用するかどうかを選択します。

### Modify

照会リストから登録されたストアの詳細情報を照会したり、情報を変更することができます。

![gamebase_purchase_03_201812](https://static.toastoven.net/prod_gamebase/gamebase_purchase_03_201812.png)
- 照会リストから登録されたストアを選択すると、詳細情報を照会することができます。
- **修正**ボタンをクリックすればストアアプリIDを除くアプリ名、ストアアプリ、使用有無情報を修正することができます。
- **削除**ボタンをクリックすればストアの情報を削除することができます。ただし、使用有無の状態が未使用のストアのみ削除できます。

## Product
ストアで販売する商品を登録できます。
**商品**タブで新しい商品の登録や登録した商品の管理を行えます。

- (1) **登録**：1つのストアアイテムIDを利用して複数の商品を登録できます。
- (2) **ストアアイテム状態変更**：1つのストアアイテムIDに登録された商品の使用可否を一回に変更できます。
- (3) **フィルタ**：ストア、ストアアイテムID、商品IDフィルタを提供し、簡単に検索できます。検索値がない場合、すべてのストアの商品リストが表示されます。

![gamebase_purchase_04_202006](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_04_202006.png)

### Register

新しい商品を登録するには**商品リスト**画面の**登録**ボタンをクリックします。
#### 1. 直接入力を利用した登録方法
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_05_202006.png)

* (1) **商品ID**：決済リクエスト時に使用する商品IDを入力します。該当IDを通してSDKで購入APIを呼び出すと入力した商品の購入が進行されます。
* (2) **商品名**：決済される商品の名前を入力します。この場所に入力した内容を元に決済履歴照会および指標で該当商品名が表示されます。
* (3) **使用有無**：商品の使用有無を選択します。SDKで商品リストをリクエストする時、使用有無が「USE」の商品だけが商品リストに伝達されます。
* (4) **商品追加**：追加商品を登録する時、**+**ボタンを選択すると商品入力欄が追加されます。
* (5) **ストア**：登録する外部ストアを選択します。登録するストアがない場合、**ストア**メニューで先にストアを登録する必要があります。
* (6) **ストアアイテムID**：ストア登録後に発行されたID情報を入力します。Gamebase商品に登録されたリストは選択したストアに決済をリクエストした時、この部分に入力した内容を利用して決済が行われます。
* (7) **ストアアイテムタイプ**：登録する商品タイプを選択します。Google Play、App Storeの場合、定期購入アイテムを登録できます。それ以外のストアを選択すると消費性アイテムとして登録されます。

#### 2. ファイルアップロードを利用した登録方法
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_06_202006.png)

* ファイルをアップロードして商品を登録できます。
* ファイルをアップロードしての商品登録は、一度に最大1,000個まで可能です。
* 入力形式が正しくない場合、商品登録ができないため、入力形式に注意する必要があります。
* ファイルのエンコード形式が「UTF-8」ではない場合、日本語が正常に保存できないことがあります。
* ファイルの登録に失敗した場合、結果ウィンドウの**ダウンロード**から失敗したリストをダウンロードして確認できます。


### Modify

照会リストで、登録された商品の詳細情報の照会や情報の変更を行えます。
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_07_202006.png)

- 照会リストで各アイテムを選択すると、登録されたアイテムの詳細情報を照会できます。
- **修正**ボタンをクリックすると、ストアとアイテム番号、商品タイプ以外の情報を変更できます。
- 修正が可能な項目は**商品名**、**使用有無**、**ストアアイテムID**項目です。それ以外の項目は修正できませんので、登録時に注意してください。

## Transactions

決済情報を照会できます。
検索タイプを自由に選択して決済情報を照会できます。
決済履歴照会結果は、右上の**ダウンロード**ボタンをクリックしていつでもダウンロードできます。

### Properties

#### Search conditions
選択した検索タイプに応じて表示される検索項目が異なります。

##### (1)一般検索
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_10_202006.png)

下記の検索条件を満たす結果を検索できます。
- **検索期間**：ユーザーが購入を試行した期間、降順/昇順からソート方法を選択できる。
- **ストア**：検索するストア情報
- **ストアアイテムID**：ストアに登録した後に発行されたID情報
- **アイテム**：検索するアイテムを選択
- **ユーザーID**：決済したユーザーID
- **決済状態**：検索する決済状態基準

##### (2) Transaction ID検索
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_11_202006.png)

決済すると作成されるTransaction IDを使用して検索できます。

##### (3)領収書検索
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_12_202006.png)
決済時に支給された領収書情報で照会できます。


#### 検索結果
検索結果項目は下記のとおりです。

- **Transaction ID**：Gamebase内で決済を区別できる固有番号
- **ストア**：決済したストア情報
- **ユーザーID**：決済したユーザーID
- **商品名**：ユーザーがアプリで購入した実際の商品名
- **商品ID(ストアアイテムID)**：ユーザーがアプリで購入した実際の商品IDおよびストアで実際に決済されたストアアイテムID
- **ストアアイテムタイプ**：ユーザーがアプリで購入した実際の商品タイプ
- **価格/貨幣単位**：ユーザーが購入したアイテムの価格および貨幣単位
- **消費状態**：決済したアイテムの支給状態
- **決済状態**：決済の現在の進行状態
- **Store Reference Key**：ストアで発行する決済固有番号
- **決済予約日時**：ユーザーが購入を試行または完了した時間
- **返品日時**：ユーザーアイテムが返品された時間
- **追加情報**：SDKで決済リクエスト時に伝達した追加情報(developer payload)

#### 決済状態の変更
検索した決済情報の状態は下記のとおりです。
- **Success**
	- 決済完了
    - 決済処理が正常に完了した場合を意味します。
    - Refund状態に変更できます。
- **Reserved**
	- 決済進行中
	- ストアを通した決済がこれ以上進行できないか、決済検証まで行われなかった場合を意味します。
	- Success、Refund状態に変更できます。
- **Failure**
	- 決済検証失敗
	- ストアで決済を進行したが、決済検証でエラーが発生した場合を意味します。
	- Success、Refund状態に変更できます。
- **Refund**
	- 払戻完了
	- 管理者が手動で、ストアで払戻処理をアップデートした場合です。
	- 他の決済状態に変更できません。

##### Success変更
![gamebase_purchase_08_201812](https://static.toastoven.net/prod_gamebase/gamebase_purchase_08_201812.png)
決済進行時に発行された**領収書番号**、**価格**、**通貨**情報を入力すると、状態を変更できます。

##### Refund変更
![gamebase_purchase_09_201812](https://static.toastoven.net/prod_gamebase/gamebase_purchase_09_201812.png)
追加情報を入力しないで状態を選択した後、変更を選択します。
変更された決済情報は、変更できないため、慎重に確認してください。

#### 領収書の検証
![image alt](http://static.toastoven.net/prod_gamebase/Operators_Guide/Console_IAP_Transaction3.1.png)
* 照会された領収書の決済が有効かどうかを検証できます。
* 各フィールドを比較した結果を確認できます。ストアから受け取ったレスポンス値をJSON形式で提供するため、必要な場合はデータを直接確認できます。
* 現在はApp Store決済のみ検証できます。

## Payment abusing monitoring

決済に関する不正行為情報を照会して制裁できます。

![image alt](http://static.toastoven.net/prod_gamebase/Operators_Guide/Console_IAP_PaymentAbusing1_1.0.png)

下記の検索条件を利用して決済および返金情報を照会できます。
決済および返金履歴は、右上の**ダウンロード**ボタンをクリックしていつでもダウンロードできます。
#### 検索条件

- **返金日時**：返金処理された時間
- **ユーザーID**：決済したユーザーID
- **返金件数**：ユーザーが返金を受けた回数。入力した回数以上が照会されます。
- **返金金額**：ユーザーが返金を受けた金額。入力した金額以上が照会されます。

#### 検索結果
- **ユーザーID**：決済したユーザーID
- **ストア**：決済したストア情報
- **返金件数**：ユーザーが返金を受けた回数
- **返金金額**：ユーザーが返金を受けた金額
- **決済件数(照会期間)**：ユーザーが照会期間内に決済した回数
- **決済金額(照会期間)**：ユーザーが照会期間内に決済した金額
- **決済件数(累積)**：ユーザーが決済した累積回数
- **決済金額(累積)**：ユーザーが決済した総額
- **決済件数(過去3か月)**：ユーザーが過去3か月間に決済した回数
- **決済金額(過去3か月)**：ユーザーが過去3か月に決済した金額
- **状態**：ユーザーの現在状態
- **手動制裁**：ユーザーの状態に応じて利用停止または停止解除

#### 手動制裁
![gamebase_member_02_201812](https://static.toastoven.net/prod_gamebase/gamebase_member_02_201812.png)

照会したゲームユーザーのアカウント状態を変更することができる機能です。
各状態からは、次のように変更できます。
- **正常**：利用停止、退会状態に変更できます。退会させると該当アカウントの情報を復元できないため、処理前によく確認してください。
- **利用停止**：利用停止の解除を行うことができます。
- **退会**：該当ボタンが表示されません。

#### 決済履歴の確認

検索されたリストからユーザーIDをクリックすると、検索期間の決済詳細履歴を照会できます。

![image alt](http://static.toastoven.net/prod_gamebase/Operators_Guide/Console_IAP_PaymentAbusing2_1.0.png)

#### 決済履歴
- **決済予約日時**：ユーザーが購入を試行または完了した時間
- **返金日時**：ユーザーアイテムが返金を受けた時間
- **Transaction ID**：Gamebase内で決済を区別することができる固有番号
- **ストア**：決済したストア情報
- **アイテム名**：ユーザーがアプリで購入した実際のアイテム名
- **価格**：ユーザーが購入したアイテムの価格
- **通貨単位**：ユーザーが購入時に使用した通貨の種類
- **決済状態**：決済の現在進行状態

#### 決済に関する不正行為の自動制裁設定

自動制裁設定を使用するには、**使用**ボタンをクリックして設定値を入力します。

![image alt](http://static.toastoven.net/prod_gamebase/Operators_Guide/Console_IAP_PaymentAbusing3_1.0.png)

#### 設定情報

![image alt](http://static.toastoven.net/prod_gamebase/Operators_Guide/Console_IAP_PaymentAbusing4_1.0.png)

* **利用停止期間**自動制裁適用時の利用停止期間を入力します。
    * **永久停止**：永久に利用を停止する時に選択します。
    * **期間指定**：利用停止期間を入力します。日(day)
* **自動制裁条件設定**設定された条件に一致するユーザーは自動制裁処理されます。最低1個以上を設定する必要があります。
    * **返金件数**：不正行為に該当する返金件数を入力します。
    * **返金金額**：不正行為に該当する返金額を入力します。
* **自動制裁メッセージ設定**
    * ユーザーに表示する利用停止メッセージを入力します。
    * ユーザーに表示するメッセージを多言語で入力して簡単に再使用できるようにテンプレートを提供します。あらかじめ登録したテンプレートを選択して登録します。
* **リーダーボードの削除**
    * 自動制裁を行う時、該当ゲームユーザーのLeaderboardデータも同時に削除するかどうかを設定します。
    * 選択して登録すると、自動制裁適用時にリーダーボードからゲームユーザーのデータが削除されます。<font color="red">該当データは復旧できないため、</font> 注意が必要です。
