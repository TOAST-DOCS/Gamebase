## IAP 메뉴 이용에 앞서
![gamebase_purchase_01_201812](http://static.toastoven.net/prod_gamebase/Console_IAP_Select_currency_1.0.png)
IAP 메뉴를 이용하려면 결제 지표를 위한 통화를 먼저 선택해 주셔야 합니다.
최초 한번만 설정 가능하며 Analytics 매출지표에는 설정된 통화코드로 지표가 노출됩니다.
한번 선택한 통화코드는 변경할 수 없으니 신중히 선택해 주세요.

## Game > Gamebase > 콘솔 사용 가이드 > 결제

인앱 결제와 관련된 정보를 등록하고 내역을 조회할 수 있습니다.
Gamebase에서는 TOAST IAP(In-App Purchase, 인앱 결제) 서비스를 사용합니다.

## Store

게임 내에서 상품을 판매하기 위해 스토어를 등록합니다.
**Store** 탭의 **스토어 정보 리스트**에서 새 스토어를 등록하거나 이미 등록한 스토어를 관리할 수 있습니다.
![gamebase_purchase_01_201812](https://static.toastoven.net/prod_gamebase/gamebase_purchase_01_201812.png)

### Register

새로운 스토어를 등록하려면 **스토어 정보 리스트** 화면의 **등록** 버튼을 클릭합니다.

![gamebase_purchase_02_201812](https://static.toastoven.net/prod_gamebase/gamebase_purchase_02_201812.png)

* **스토어**  등록하고자 하는 외부 스토어를 선택합니다.  등록하고자 하는 스토어가 없다면, [고객센터](https://toast.com/support/inquiry)로 연락주시기 바랍니다.
* **앱 이름**   등록하고자 하는 게임의 이름을 입력합니다.
* **스토어 앱 ID**   스토어에서 발급받은 정보를 입력합니다.
* **사용 여부**  스토어 사용 여부를 선택합니다.

### Modify

조회 목록에서 등록된 스토어의 상세 정보를 조회하거나 정보를 변경할 수 있습니다.

![gamebase_purchase_03_201812](https://static.toastoven.net/prod_gamebase/gamebase_purchase_03_201812.png)
- 조회 목록에서 등록된 스토어를 선택하면 상세 정보를 조회할 수 있습니다.
- **수정** 버튼을 클릭하면 스토어 앱 ID를 제외한 앱 이름, 스토어 앱, 사용 여부 정보를 수정할 수 있습니다.
- **삭제** 버튼을 클릭하면 스토어의 정보를 삭제할 수 있습니다. 단, 사용여부가 미사용인 스토어 삭제만 가능합니다.

## Product

스토어에서 판매할 상품을 등록할 수 있습니다.
**상품** 탭에서 새 상품을 등록하거나 이미 등록한 상품을 관리할 수 있습니다.
- (1) **등록** : 하나의 스토어 아이템 ID를 이용해 여러개의 상품을 등록할 수 있습니다
- (2) **스토어 아이템 상태 변경** : 하나의 스토어 아이템 ID로 등록된 상품들의 사용 여부를 한번에 변경할 수 있습니다.
- (3) **필터** : 스토어/스토어 아이템 ID/상품 ID 필터를 제공하여 검색을 편리하게 할 수 있습니다. 검색값이 없을 경우 모든 스토어의 상품 목록이 노출됩니다.

![gamebase_purchase_04_202006](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_04_202006.png)

### Register

새로운 상품을 등록하려면 **상품 목록** 화면의 **등록** 버튼을 클릭합니다.
#### 1. 직접 입력을 이용한 등록 방법
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_05_202006.png)

* (1) **상품 ID** : 결제 요청시 사용 할 상품 ID를 입력합니다. 해당 ID를 통해 SDK에서 구매 API를 호출해야 입력한 상품으로 구매가 진행됩니다.
* (2) **상품 이름** : 결제 되는 상품의 이름을 입력합니다. 이 곳에 입력한 내용을 기반으로 결제 내역 조회 및 지표에서 해당 상품명이 표시됩니다.
* (3) **사용 여부** : 상품의 사용 여부를 선택합니다. SDK에서 상품목록 요청시 사용여부가 'USE'로 선택된 상품들만 상품 목록으로 전달됩니다.
* (4) **상품 추가** : 추가 상품을 등록하고자 할 때 **+** 버튼을 선택하면 상품 입력란이 추가됩니다.
* (5) **스토어** : 등록하고자 하는 외부 스토어를 선택합니다.  등록하려는 스토어가 없다면 **스토어** 메뉴에서 먼저 스토어를 등록해야 합니다.
* (6) **스토어 아이템 ID** : 스토어 등록 후 발급받은 ID 정보를 입력합니다. Gamebase 상품에 등록된 목록은 선택한 스토어에 결제 요청 시 이 부분에 입력한 내용을 이용하여 결제가 이루어집니다.
* (7) **스토어 아이템 유형**  등록하고자 하는 상품 유형을 선택합니다. Google play, App store의 경우 구독 아이템 등록이 가능하며 그 외의 스토어를 선택할 경우 일회성 아이템으로 등록됩니다.

#### 2. 파일 업로드를 이용한 등록 방법
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_06_202006.png)

* 파일 업로드를 통해 상품 등록을 진행할 수 있습니다.
* 파일 업로드를 통한 상품 등록은 한 번에 최대 1,000개까지 가능합니다.
* 입력 형식이 올바르지 않은 경우 상품 등록이 진행되지 않으므로 입력 형식에 주의해야 합니다.
* 파일의 인코딩 형식이 'UTF-8'이 아닐 경우 한글 입력이 정상적으로 등록되지 않으므로 주의해야 합니다.
* 파일 등록에 실패하였을 경우 결과창의 **다운로드**항목을 통해 실패한 목록을 다운받아 확인할 수 있습니다.


### Modify

조회 목록에서 등록된 상품의 상세 정보를 조회하거나 정보를 변경할 수 있습니다.
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_07_202006.png)
- 조회 목록에서 각 아이템을 선택하면 등록된 아이템의 상세 정보를 조회할 수 있습니다.
- **수정** 버튼을 클릭하면 스토어와 아이템 번호 및 상품 유형을 제외한 나머지 정보를 변경할 수 있습니다.
- 수정이 가능한 항목은 **상품 이름**, **사용 여부**, **스토어 아이템 ID** 항목이며 그 외의 항목은 수정할 수 없으므로 등록 시 주의가 필요합니다.

## Transactions

결제 정보를 조회할 수 있습니다.
원하는 검색 유형을 선택하여 원하는 결제 정보를 편리하게 조회할 수 있습니다.
결제 내역 조회 결과는 오른쪽 상단의 **다운로드** 버튼을 클릭해 언제든지 다운로드할 수 있습니다.

### Properties

#### Search conditions
선택한 검색 유형에 따라 검색 항목이 다르게 표시됩니다.

##### (1) 일반 검색
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_10_202006.png)

아래의 검색 조건을 만족하는 결과를 검색할 수 있습니다.
- **검색 기간**: 사용자가 구입을 시도한 기간. 오른쪽의 내림차순/오름차순 항목을 통해 정렬을 선택할 수 있음
- **스토어**: 검색하고자 하는 스토어 정보
- **스토어 아이템 ID** : 스토어에 등록한 후 발급받은 ID 정보
- **아이템** : 검색하고자 하는 아이템을 선택
- **유저 ID**: 결제한 사용자 ID
- **결제 상태**: 검색하고자 하는 결제 상태 기준

##### (2) Trnasaction ID 검색
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_11_202006.png)

결제를 하면 생성되는 Transaction ID를 사용해 검색할 수 있습니다.

##### (3) 영수증 검색
![gamebase_ban_01_201812](https://static.toastoven.net/prod_gamebase/Operators_Guide/gamebase_purchase_12_202006.png)
결제 시 지급된 영수증 정보를 가지고 조회할 수 있습니다.


#### 검색 결과
검색 결과 항목은 아래와 같습니다.

- **Transaction ID**: Gamebase 내에서 결제를 구별할 수 있는 고유 번호
- **스토어**: 결제된 스토어 정보
- **유저 ID**: 결제한 사용자 아이디
- **상품 이름**: 사용자가 앱에서 구입한 실제 상품 이름
- **상품 ID(스토어 아이템 ID)**: 사용자가 앱에서 구입한 실제 상품 아이디 및 스토어에 실제로 결제된 스토어 아이템 ID
- **스토어 아이템 유형**: 사용자가 앱에서 구입한 실제 상품 유형
- **가격/화폐단위**: 사용자가 구입한 아이템의 가격 및 화폐 단위
- **소비 상태**: 결제한 아이템의 지급 여부
- **결제 상태**: 결제의 현재 진행 상태
- **Store Reference Key**: 스토어에서 발급해주는 결제 고유 번호
- **결제예약일시**: 사용자가 구입을 시도 또는 완료한 시간
- **환불일시**: 사용자 아이템이 환불된 시간
- **추가정보**: SDK에서 결제 요청 시 전달한 추가 정보(Developer payload)

#### 결제 상태 변경
검색한 결제 정보의 상태는 아래와 같으며 각 상태는 아래와 같습니다.
- **Success**
	- 결제 완료
    - 결제 처리가 정상적으로 완료된 경우를 의미합니다.
    - Refund 상태로 변경 가능합니다.
- **Reserved**
	- 결제 진행 중
	- 스토어를 통한 결제가 더 이상 진행되지 않거나 결제 검증까지 진행되지 않은 경우를 의미합니다.
	- Success, Refund 상태로 변경 가능합니다.
- **Failure**
	- 결제 검증 실패
	- 스토어에서 결제를 진행했으나 결제 검증에서 오류가 발생한 경우를 의미합니다.
	- Success, Refund 상태로 변경 가능합니다.
- **Refund**
	- 환불 완료
	- 관리자가 수동으로 스토어에서 환불 처리에 대한 여부를 업데이트한 경우입니다.
	- 다른 결제 상태로 변경이 불가능합니다.
- **UserClose** 
	- 유저가 결제 진행중 취소


##### Success 변경
![gamebase_purchase_08_201812](https://static.toastoven.net/prod_gamebase/gamebase_purchase_08_201812.png)
결제 진행 시 발급받은 **영수증 번호**, **가격**, **통화** 정보를 입력해야 상태를 변경할 수 있습니다.

##### Refund 변경
![gamebase_purchase_09_201812](https://static.toastoven.net/prod_gamebase/gamebase_purchase_09_201812.png)
추가 정보 입력 없이 상태를 선택한 후 변경을 선택합니다.
변경된 결제 정보는 이후 변경이 불가능하므로 신중하게 확인해야 합니다.

#### 영수증 검증
![image alt](http://static.toastoven.net/prod_gamebase/Operators_Guide/Console_IAP_Transaction3.1.png)
* 조회된 영수증의 결제가 유효한지 검증할 수 있습니다.
* 각 필드를 비교한 결과를 확인할 수 있습니다. 스토어에서 받은 응답값을 JSON 형식으로 제공하므로 필요한 경우 데이터를 직접 확인하실 수 있습니다.
* 현재는 App Store 결제 건만 검증할 수 있습니다.

## Payment abusing monitoring

결제 어뷰징 정보를 조회하고 제재할 수 있습니다.

![image alt](http://static.toastoven.net/prod_gamebase/Operators_Guide/Console_IAP_PaymentAbusing1_1.0.png)

아래 검색 조건을 이용해 원하는 결제 및 환불 정보를 검색할 수 있습니다.
결제 및 환불 내역은 오른쪽 상단의 **다운로드** 버튼을 클릭해 언제든지 다운로드할 수 있습니다.

#### 검색 조건

- **환불 일시**: 환불 처리된 시간
- **유저 ID**: 결제한 사용자 ID
- **환불 건수**: 사용자가 환불받은 횟수로 입력한 횟수 이상이 조회됩니다.
- **환불 금액**: 사용자가 환불받은 금액으로, 입력한 금액 이상이 조회됩니다.

#### 검색 결과
- **유저 ID**: 결제한 사용자 ID
- **스토어**: 결제된 스토어 정보
- **환불 건수**: 사용자가 환불받은 횟수
- **환불 금액**: 사용자가 환불받은 금액
- **결제 건수(조회 기간)**: 사용자가 조회 기간 내 결제한 횟수
- **결제 금액(조회 기간)**: 사용자가 조회 기간 내 결제한 금액
- **결제 건수(누적)**: 사용자가 결제한 전체 누적 횟수
- **결제 금액(누적)**: 사용자가 결제한 전체 금액
- **결제 건수(최근 3개월)**: 사용자가 최근 3개월간 결제한 횟수
- **결제 금액(최근 3개월)**: 사용자가 최근 3개월간 결제한 금액
- **상태**: 사용자의 현재 상태
- **수동 제재**: 사용자 상태에 따라 이용 정지 또는 정지 해제

#### 수동 제재
![gamebase_member_02_201812](https://static.toastoven.net/prod_gamebase/gamebase_member_02_201812.png)

조회한 게임 유저의 계정 상태를 변경할 수 있는 기능입니다.
상태별로 변경할 수 있는 경우는 아래와 같습니다.

- **정상**: 이용 정지, 탈퇴 상태로 변경할 수 있습니다. 탈퇴 시에는 해당 계정 정보를 되돌릴 수 없으므로 처리 전 확인 및 주의가 필요합니다.
- **이용 정지**: 이용 정지 해제를 진행할 수 있습니다.
- **탈퇴**: 상태를 변경할 수 없으므로 해당 버튼이 표시되지 않습니다.

#### 결제 내역 확인

검색된 목록에서 유저 ID를 클릭하면 검색 기간의 결제 상세 내역을 조회할 수 있습니다.

![image alt](http://static.toastoven.net/prod_gamebase/Operators_Guide/Console_IAP_PaymentAbusing2_1.0.png)

#### 결제 내역
- **결제 예약 일시**: 사용자가 구입을 시도 또는 완료한 시간
- **환불일시**: 사용자 아이템이 환불된 시간
- **Transaction ID**: Gamebase 내에서 결제를 구별할 수 있는 고유 번호
- **스토어**: 결제된 스토어 정보
- **아이템 이름**: 사용자가 앱에서 구입한 실제 아이템 이름
- **가격**: 사용자가 구입한 아이템 가격
- **화폐 단위**: 사용자가 구입 시 사용한 통화 종류
- **결제 상태**: 결제의 현재 진행 상태

#### 결제 어뷰징 자동 제재 설정

자동 제재 설정을 사용하려면 **사용** 버튼을 클릭해 설정 값을 입력합니다.

![image alt](http://static.toastoven.net/prod_gamebase/Operators_Guide/Console_IAP_PaymentAbusing3_1.0.png)

#### 설정 정보

![image alt](http://static.toastoven.net/prod_gamebase/Operators_Guide/Console_IAP_PaymentAbusing4_1.0.png)

* **이용 정지 기간**  자동 제재 적용 시 이용 정지 기간을 입력합니다.
    * **영구 정지**: 영구 이용 정지를 하려면 선택합니다.
    * **기간 지정**: 이용 정지 기간을 일(day) 단위로 지정합니다.
* **자동 제재 조건 설정**  설정된 조건에 해당되는 사용자는 자동 제재 처리됩니다. 최소 1개 이상 설정해야 합니다.
    * **환불 건수**: 어뷰징에 해당하는 환불 건수를 입력합니다.
    * **환불 금액**: 어뷰징에 해당하는 환불 금액을 입력합니다.
* **자동 제재 메시지 설정**  
    * 사용자에게 표시할 이용 정지 메시지를 입력합니다.
    * 사용자에게 표시할 메시지를 다국어로 입력하여 손쉽게 재사용할 수 있도록 템플릿을 제공합니다. 미리 등록한 템플릿을 선택해 등록합니다.
* **리더보드 삭제**
    * 자동 제재 시 해당 게임 유저의 리더보드 데이터도 함께 삭제할지 여부를 설정합니다.
    * 선택 후 등록하면 자동 제재 적용 시 리더보드에서 게임 유저의 데이터가 삭제되며 <font color="red">해당 데이터는 복구되지 않으므로</font> 주의해야 합니다.
