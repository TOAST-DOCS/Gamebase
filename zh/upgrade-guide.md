## Game > Gamebase > Upgrade Guide

## 2.21.2

### iOS

* 如果在Gamebase iOS SDK 2.21.1中启用bitcode后进行**archive build**，则将出现错误。
    * 使用bitcode时，请使用已解决上述问题的Gamebase iOS SDK 2.21.2。

## 2.21.0

### Android

* 因向jCenter发布的Gamebase Android SDK 2.21.0打包出现错误，如果声明**mavenCentral()**之前先声明**jcenter()**，则将在所有的Gamebase API出现崩溃。 
    * 请使用正常发布的Gamebase Android SDK 2.21.1或声明**jcenter（）之前先声明**mavenCentral（）**。
* Maven Repository
    * 因jCenter停止向一般用户提供服务([https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/](https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/) )，无法再上载新版本。(对jCenter的访问也将于2022年2月1日结束。)
    * 从Gamebase Android SDK 2.21.0以上版本开始只在**mavenCentral()**发布，而不在**jcenter()**发布，因此需要在gradle repository中添加mavenCentral。

```groovy
repositories {
    // >>> For Gamebase SDK
    mavenCentral()
    ...
}
```

#### Line IdP

* 使用Line IdP时，当Line SDK被更新时，若不在Gradle中设置**JavaVersion.VERSION_1_8**，则将导致打包失败。(请参考以下示例。)
* 使用Line IdP时，因在Line SDK中声明为**android:allowBackup="false"**，应用程序打包时可能在Manifest merger出现fail。如果打包失败，请参考以下示例，将tools:replace=“android:allowBackup”在应用程序标签中声明。 

```groovy
android {
    compileOptions {
        // >>> [Line IdP]
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8 
    }
    
}
```

```xml
<application
      tools:replace="android:allowBackup"
      ... >
```

### iOS

* 如果在Gamebase iOS SDK 2.21.0上使用bitcode，则将出现错误。 
    * 如果要使用bitcode，请使用Gamebase iOS SDK 2.21.1。

## 2.20.2
 
### iOS

#### Facebook IdP

* 在Gamebase iOS SDK 2.20.2上Facebook SDK已更新至9.1.0。
    * 需要对Facebook SDK进行额外的设置，请在info.plist中添加以下值。如果不进行设置，则将导致崩溃。
        * FacebookAutoLogAppEventsEnabled
        * FacebookAdvertiserIDCollectionEnabled
* 关于详细信息，请参考[Facebook iOS SDK指南](https://developers.facebook.com/docs/app-events/getting-started-app-events-ios)。

## 2.19.0

### Android

#### Weibo IdP

* 若在Gamebase Android SDK 2.19.0中交替使用Weibo IdP登录和其他IdP登录，则将发生崩溃。
    * 如果需要用Weibo IdP，请使用已解决上述问题的Gamebase Android SDK 2.19.1。

## 2.18.2

### Android

#### Removed APIs

* 已经从Gamebase Android SDK 2.6.0中删除被deprecated的函数。
    * **GamebaseConfiguration.Builder.setFCMSenderId()**
    * **GamebaseConfiguration.Builder.setTencentAccessKey()**
    * **GamebaseConfiguration.Builder.setTencentAccessId()**

## 2.18.0

### Android

#### Purchase Google

* 如果在Gamebase Android SDK 2.18.0中调用Google道具支付，则将发生崩溃。 
    * 如果需要用Weibo IdP，请使用已解决上述问题的Gamebase Android SDK 2.18.1。

## 2.17.0

### Android

* 若在Gamebase Android SDK 2.17.0中调用Gamebase.ImageNotice.showImageNotices API，则将发生崩溃。
    * 请使用已解决2.17.0中发生崩溃或在OS 5.0~6.0中Custom Scheme Event不正常启动等问题的Gamebase Android SDK 2.17.4。
 
## 2.15.1

### iOS

* 当使用gamebase SDK中定义的**gamebaseeventcategory**类型而不使用nsstring时，要将此类型更改为**tcgbgamebaseeventcategory**。

## 2.15.0

### Android

#### Purchase Google

* 使用**gamebase-adapter-purchase-google**时，若要将Gamebase SDK 2.15.0以下版本升级到2.15.0以上版本，则必须将**以前版本的Game Client Version设置为“必须更新”**。 
	* 因为Google Billing Client模块儿被更新，使不同的Billing Client版本适用于多个终端机的情况下，如果购买道具时出现错误，进行“支付在处理”时将出现问题。

## 2.6.0

### Unity

#### Android Limitation

* Android Support Library版本升至28.0.0，Unity 5、Unity 2017.1、Unity 2017.2中Android创建失败。
	* 若使用Unity 2017.3以下版本的Editor，请安装Unity 2017.3以上版本后，复制“Editor/Data/PlaybackEngines/AndroidPlayer/Tools/gradle/lib”文件夹，按照正在使用的Unity Editor的相同路径覆盖后，如下修改mainTemplate.gradle文件。

```groovy
// GENERATED BY UNITY. REMOVE THIS COMMENT TO PREVENT OVERWRITING WHEN EXPORTING AGAIN
buildscript {
	repositories {
		jcenter()
        // >>> For download Gradle Android Plugin
        maven {
            url 'https://maven.google.com'
        }
	}

	dependencies {
		//classpath 'com.android.tools.build:gradle:2.1.0'
        // >>> Update Gradle Android Plugin version
        classpath 'com.android.tools.build:gradle:2.3.0'
	}
}
```

#### Firebase推送

* 使用Firebase Cloud Messaging时，要将从Firebase Console中下载的google-services.json文件转换为xml资源，并添加到项目中才能成功收到推送。
    * 使用Gamebase 2.5.0以前的旧版本时，没有xml资源的情况下也可收到推送，但使用Gamebase 2.6.0以上版本时必须要有xml资源才能收到。
* 请参考以下实施指南。
    * [\[Game > Gamebase > Android SDK 使用指南 > push > Settings > Firebase\]](./aos-push/#firebase)

#### Standalone

* Removed Japan Purchase
	* 日本支付已FadeOut。
	* 若使用GamebaseUnitySDK_IAPAdapter，请直接删除如下文件夹。
        * Asset/Toast/Common
        * Asset/Toast/Core
        * Asset/Toast/IAP
        * Asset/Toast/Standalone

### Android

#### Limitation

* minSdkVersion由15(IceCreamSandwichMR1, 4.0.3)更改为16(JellyBean, 4.1)。
	* OS 4.1以下的终端机中无法保证正常运行，因此项目的minSdkVersion为15时，请更改为16。

#### Removed APIs

* 清除的函数如下。请更改为替代函数。
    * **Gamebase.getAuthBanInfo()**已清除。请更改为**Gamebase.getBanInfo()**。
    * **Gamebase.getLanguageCode()**已清除。请更改为**Gamebase.getDeviceLanguageCode()**。
    * **new GamebaseConfiguration.Builder(void)**已清除。请更改为**GamebaseConfiguration.newBuilder()**。
    * **new GamebaseConfiguration.Builder.setAppId()**已清除。请更改为**GamebaseConfiguration.newBuilder()**。
    * **new GamebaseConfiguration.Builder.setAppVersion()**已清除。请更改为**GamebaseConfiguration.newBuilder()**。

#### Changed/Deprecated APIs

* Gamebase.activeApp()为自动调用，因此可不再调用。
* 作为Gamebase.initialize()的因素需要的GamebaseConfiguration的创建方法已更改。
    * 取代**new GamebaseConfiguration.Builder(String, String)**，调用**GamebaseConfiguration.newBuilder()**。
* 请勿再调用LaunchingStatus.isPlayable()。
	* 请参考[\[Game > Gamebase > Android SDK使用指南 > 初始化 > Launching Information\]](./aos-initialization/#launching-information)文件，按照Launching Status Code直接决定是否可以玩游戏。
* Purchase
    * Store Code无法更改，因此应从**GamebaseConfiguration.newBuilder()**传输Store Code。
        * Gamebase.Purchase.getStoreCode() / Gamebase.Purchase.setStoreCode()将清除。请勿再使用。
    * Gamebase.Purchase.requestRetryTransaction()现在不调用也无妨。
* Push
    * 自Gamebase Android SDK 2.6.0以上起，发送推送信息时，应通过Gamebase控制台的**推送**选项卡的菜单发送。
        * 若低于Gamebase Android SDK 2.6.0，应从Gamebase控制台的**推送（旧）**选项卡发送推送。
    * GamebaseConfiguration.Builder.setFCMSenderId()现在不调用也无妨。
    * 调用GamebaseConfiguration.Builder.setTencentAccessKey()、 GamebaseConfiguration.Builder.setTencentAccessId()时，应清除API调用，并在build.gradle中如下声明。

```groovy
android {
    defaultConfig {
        ...
        // >>> For Tencent Push Notification
        manifestPlaceholders = [
            XG_ACCESS_ID : "1234567890",
            XG_ACCESS_KEY : "ABCDEFGHIJKL",
        ]
    }
}
```

## 2.4.4

### Unity

* Setting Tool已升级。
    * 文件夹结构更改，应将之前版本的SettingTool完全删除后重新安装。

## 2.2.2

### Unity

* GamebaseUnitySDKSettings类的**storeCodeAOS**变量名更改为**storeCodeAndroid**。
    * 若存在参考**storeCodeAOS**定义Store Code的代码或Prefab，则变量参考失败，因此请更改为**storeCodeAndroid**变量。

## 2.2.0

### Unity

* GamebaseMainActivity的Package Name已更改。
    * AndroidManifest.xml的MainActivity声明若未如下更改，则会发生崩溃。
    * **com.toast.gamebase.activity.GamebaseMainActivity** -> **com.toast.android.gamebase.activity.GamebaseMainActivity**

```xml
<manifest>
    ...
    <application>
    ...
        <activity android:name="com.toast.android.gamebase.activity.GamebaseMainActivity"
            android:launchMode="singleTask"
            android:configChanges="keyboard|keyboardHidden|screenLayout|screenSize|orientation"
            android:label="@string/app_name">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    ...
    </application>
    ...
</manifest>
```

## 2.1.0

### Common

#### Removed APIs

* 未使用的TransferKey功能已清除。
	* 若需要Guest账号迁移功能，请使用自Gamebase SDK 2.2.1起添加的[\[Game > Gamebase > Unity SDK使用指南 > 验证 > TransferAccount\]](./unity-authentication/#transferaccount)功能。
